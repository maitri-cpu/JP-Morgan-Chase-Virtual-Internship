{"version":3,"sources":["DataStreamer.ts","Graph.tsx","App.tsx","index.tsx"],"names":["DataStreamer","callback","request","XMLHttpRequest","open","API_URL","onload","status","JSON","parse","responseText","alert","send","Graph","table","React","createElement","elem","document","getElementsByTagName","window","perspective","this","worker","stock","top_ask_price","top_bid_price","timestamp","console","log","load","setAttribute","update","props","data","map","el","top_ask","price","top_bid","Component","App","_this","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","state","showGraph","react_default","a","src_Graph_0","_this2","x","interval","setInterval","getData","serverResponds","setState","clearInterval","_this3","className","onClick","getDataFromServer","renderGraph","ReactDOM","render","src_App_0","getElementById"],"mappings":"sOAeMA,uGAQWC,GACb,IAAMC,EAAU,IAAIC,eACpBD,EAAQE,KAAK,MAAOJ,EAAaK,SAAS,GAE1CH,EAAQI,OAAS,WACQ,MAAnBJ,EAAQK,OACVN,EAASO,KAAKC,MAAMP,EAAQQ,eAE5BC,MAAO,mBAIXT,EAAQU,gBApBNZ,EAEGK,QAAkB,mCAsBZL,QCwCAa,oNArDbC,qFAGE,OAAOC,IAAMC,cAAc,kEAK3B,IAAMC,EAAOC,SAASC,qBAAqB,sBAAsB,GAS7DC,OAAOC,cACTC,KAAKR,MAAQM,OAAOC,YAAYE,SAAST,MAR5B,CACbU,MAAO,SACPC,cAAe,QACfC,cAAe,QACfC,UAAW,UAMTL,KAAKR,QACPc,QAAQC,IAAI,aAIZZ,EAAKa,KAAKR,KAAKR,OACfG,EAAKc,aAAa,OAAQ,UAC1Bd,EAAKc,aAAa,gBAAiB,aACnCd,EAAKc,aAAa,aAAc,iBAChCd,EAAKc,aAAa,UAAU,qBAC5Bd,EAAKc,aAAa,aAAc,uJAM9BT,KAAKR,OAGPQ,KAAKR,MAAMkB,OAAOV,KAAKW,MAAMC,KAAKC,IAAI,SAACC,GAErC,MAAO,CACLZ,MAAOY,EAAGZ,MACVC,cAAeW,EAAGC,SAAWD,EAAGC,QAAQC,OAAS,EACjDZ,cAAeU,EAAGG,SAAWH,EAAGG,QAAQD,OAAS,EACjDX,UAAWS,EAAGT,qBA/CJa,cC8DLC,qBApEb,SAAAA,EAAYR,GAAW,IAAAS,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAArB,KAAAmB,IACrBC,EAAAC,OAAAE,EAAA,EAAAF,CAAArB,KAAAqB,OAAAG,EAAA,EAAAH,CAAAF,GAAAM,KAAAzB,KAAMW,KAEDe,MAAQ,CAGXd,KAAM,GACNe,WAAW,GAPQP,6EAerB,GAAGpB,KAAK0B,MAAMC,UACZ,OAAQC,EAAAC,EAAAnC,cAACoC,EAAD,CAAOlB,KAAMZ,KAAK0B,MAAMd,mDAOhB,IAAAmB,EAAA/B,KACdgC,EAAI,EACFC,EAAWC,YAAY,WAC3BxD,EAAayD,QAAQ,SAACC,GACpBL,EAAKM,SAAU,CACbzB,KAAMwB,EACNT,WAAW,QAGfK,EACQ,KAENM,cAAcL,IAEf,sCAMI,IAAAM,EAAAvC,KACP,OACE4B,EAAAC,EAAAnC,cAAA,OAAK8C,UAAU,OACbZ,EAAAC,EAAAnC,cAAA,UAAQ8C,UAAU,cAAlB,0BAGAZ,EAAAC,EAAAnC,cAAA,OAAK8C,UAAU,eACbZ,EAAAC,EAAAnC,cAAA,UAAQ8C,UAAU,gCAMhBC,QAAS,WAAOF,EAAKG,sBANvB,wBASAd,EAAAC,EAAAnC,cAAA,OAAK8C,UAAU,SACZxC,KAAK2C,wBA7DAzB,0BCJlB0B,IAASC,OAAOjB,EAAAC,EAAAnC,cAACoD,EAAD,MAASlD,SAASmD,eAAe","file":"static/js/main.15775882.chunk.js","sourcesContent":["export interface Order {\r\n  price: Number,\r\n  size: Number,\r\n}\r\n/**\r\n * The datafeed server returns an array of ServerRespond with 2 stocks.\r\n * We do not have to manipulate the ServerRespond for the purpose of this task.\r\n */\r\nexport interface ServerRespond {\r\n  stock: string,\r\n  top_bid: Order,\r\n  top_ask: Order,\r\n  timestamp: Date,\r\n}\r\n\r\nclass DataStreamer {\r\n  // The url where datafeed server is listening\r\n  static API_URL: string = 'http://localhost:8080/query?id=1';\r\n\r\n  /**\r\n   * Send request to the datafeed server and executes callback function on success\r\n   * @param callback callback function that takes JSON object as its argument\r\n   */\r\n  static getData(callback: (data: ServerRespond[]) => void): void {\r\n    const request = new XMLHttpRequest();\r\n    request.open('GET', DataStreamer.API_URL, false);\r\n\r\n    request.onload = () => {\r\n      if (request.status === 200) {\r\n        callback(JSON.parse(request.responseText));\r\n      } else {\r\n        alert ('Request failed');\r\n      }\r\n    }\r\n\r\n    request.send();\r\n  }\r\n}\r\n\r\nexport default DataStreamer;","import React, { Component } from 'react';\r\nimport { Table } from '@jpmorganchase/perspective';\r\nimport { ServerRespond } from './DataStreamer';\r\nimport './Graph.css';\r\n\r\n/**\r\n * Props declaration for <Graph />\r\n */\r\ninterface IProps {\r\n  data: ServerRespond[],\r\n}\r\n\r\n/**\r\n * Perspective library adds load to HTMLElement prototype.\r\n * This interface acts as a wrapper for Typescript compiler.\r\n */\r\ninterface PerspectiveViewerElement extends HTMLElement{\r\n  load: (table: Table) => void,\r\n}\r\n\r\n/**\r\n * React component that renders Perspective based on data\r\n * parsed from its parent through data property.\r\n */\r\nclass Graph extends Component<IProps, {}> {\r\n  // Perspective table\r\n  table: Table | undefined;\r\n\r\n  render() {\r\n    return React.createElement('perspective-viewer');\r\n  }\r\n\r\n  componentDidMount() {\r\n    // Get element to attach the table from the DOM.\r\n    const elem = document.getElementsByTagName('perspective-viewer')[0] as unknown as PerspectiveViewerElement;\r\n\r\n    const schema = {\r\n      stock: 'string',\r\n      top_ask_price: 'float',\r\n      top_bid_price: 'float',\r\n      timestamp: 'date',\r\n    };\r\n\r\n    if (window.perspective) {\r\n      this.table = window.perspective.worker().table(schema);\r\n    }\r\n    if (this.table) {\r\n      console.log('rendering');\r\n      // Load the `table` in the `<perspective-viewer>` DOM reference.\r\n\r\n      // Add more Perspective configurations here.\r\n      elem.load(this.table);\r\n      elem.setAttribute('view', 'y_line');\r\n      elem.setAttribute('column-pivots', '[\"stock\"]');\r\n      elem.setAttribute('row-pivots', '[\"timestamp\"]');\r\n      elem.setAttribute('columns','[\"top_ask_price\"]');\r\n      elem.setAttribute('aggregates', '{\"stock\": \"distinct count\",\"top_ask_price\":\"avg\",\"top_bid_price\": \"avg\",\"timestamp\":\"distinct count\"}')\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    // Everytime the data props is updated, insert the data into Perspective table\r\n    if (this.table) {\r\n      // As part of the task, you need to fix the way we update the data props to\r\n      // avoid inserting duplicated entries into Perspective table again.\r\n      this.table.update(this.props.data.map((el: any) => {\r\n        // Format the data from ServerRespond to the schema\r\n        return {\r\n          stock: el.stock,\r\n          top_ask_price: el.top_ask && el.top_ask.price || 0,\r\n          top_bid_price: el.top_bid && el.top_bid.price || 0,\r\n          timestamp: el.timestamp,\r\n        };\r\n      }));\r\n\r\n    }\r\n  }\r\n}\r\n\r\nexport default Graph;\r\n","import React, { Component } from 'react';\r\nimport DataStreamer, { ServerRespond } from './DataStreamer';\r\nimport Graph from './Graph';\r\nimport './App.css';\r\n\r\n/**\r\n * State declaration for <App />\r\n */\r\ninterface IState {\r\n  data: ServerRespond[],\r\n  showGraph: boolean,\r\n}\r\n\r\n/**\r\n * The parent element of the react app.\r\n * It renders title, button and Graph react element.\r\n */\r\nclass App extends Component<{}, IState> {\r\n  constructor(props: {}) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      // data saves the server responds.\r\n      // We use this state to parse data down to the child element (Graph) as element property\r\n      data: [],\r\n      showGraph: false,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Render Graph react component with state.data parse as property data\r\n   */\r\n  renderGraph() {\r\n    if(this.state.showGraph) {\r\n      return (<Graph data={this.state.data}/>)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get new data from server and update the state with the new data\r\n   */\r\n  getDataFromServer() {\r\n    let x = 0;\r\n    const interval = setInterval(() => {\r\n      DataStreamer.getData((serverResponds: ServerRespond[]) => {\r\n        this.setState ({\r\n          data: serverResponds ,\r\n          showGraph: true ,\r\n        });\r\n      });\r\n      x++;\r\n      if (x > 1000)\r\n      {\r\n        clearInterval(interval);\r\n      } \r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * Render the App react component\r\n   */\r\n  render() {\r\n    return (\r\n      <div className=\"App\">\r\n        <header className=\"App-header\">\r\n          Bank & Merge Co Task 2\r\n        </header>\r\n        <div className=\"App-content\">\r\n          <button className=\"btn btn-primary Stream-button\"\r\n            // when button is click, our react app tries to request\r\n            // new data from the server.\r\n            // As part of your task, update the getDataFromServer() function\r\n            // to keep requesting the data every 100ms until the app is closed\r\n            // or the server does not return anymore data.\r\n            onClick={() => {this.getDataFromServer()}}>\r\n            Start Streaming Data\r\n          </button>\r\n          <div className=\"Graph\">\r\n            {this.renderGraph()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default App;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport './index.css';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\n\r\ndeclare global {\r\n  interface Window { perspective: any; }\r\n}\r\n\r\n/**\r\n * React App attaches the DOM to the DOM element #root in public/index.html\r\n */\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n"],"sourceRoot":""}